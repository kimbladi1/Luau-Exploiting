-- Repport any bugs to sinkZ#6982 [me]

--[[
     Build : @none
     Date : 2023 - 03 - 3 [14:41]
     Finished Date : 2023 - 03 - 04 [00:42]
     Things to fix : clear
     Things to add : clear
]]

if not game:IsLoaded() then
   game.Loaded:Wait()
end

local Get = setmetatable({},{
   __index = function(n, k)
       return game:GetService(k)
   end,
})

getgenv().Settings = {
   AimlockToggled = false -- [don't touch]
}


local UserInputService = Get.UserInputService
local Players = Get.Players

local Player = Players.LocalPlayer

local Mouse = Player:GetMouse()
local Camera = workspace.CurrentCamera


local GetClosestPlayer = function()
   local ClosestPlayer = nil
   local ClosestDistance = math.huge

   for i,v in workspace:FindFirstChild("Players"):GetDescendants() do -- Don't mind the large ass gaps between the code, I had to add them so i actually could see what the fuck i was coding
       if v.ClassName == "Model" and v.Name == "Player" and v.Parent.Name ~= Player.TeamColor.Name then
           for i, ToTarget in v:GetChildren() do
               if ToTarget.Name == "Torso" then
               
                local ScreenPosition, OnScreen = Camera:WorldToViewportPoint(ToTarget.Position)
                   local Distance = (Vector2.new(Mouse.X, Mouse.Y) - Vector2.new(ScreenPosition.X, ScreenPosition.Y)).Magnitude
       
                   if OnScreen then

                       if Distance < ClosestDistance then  

                           ClosestPlayer = ToTarget
                           ClosestDistance = Distance    
                       end
                   end
               end
           end      
       end
   end
   return ClosestPlayer
end

local WorldToScreen = function(Position)
      return Camera:WorldToScreenPoint(Position)
end

UserInputService.InputBegan:Connect(function(Input : Instance?, GameProcessed : boolean?)
   if Input.UserInputType == Enum.UserInputType.MouseButton2 and not GameProcessed then
       getgenv().Settings.__AimlockToggled = true

       while task.wait() do

           if not getgenv().Settings.__AimlockToggled then
               break
           end
           
             local AimPosition = WorldToScreen(GetClosestPlayer().Position) -- [I believe I found these calcs in an old silent aim? Credits to whoever made it]
             local MousePosition = WorldToScreen(Mouse.Hit.Position)
             local incrementX, incrementY = (AimPosition.X - MousePosition.X), (AimPosition.Y - MousePosition.Y)

             mousemoverel(incrementX, incrementY)
       end
   end
end)

UserInputService.InputEnded:Connect(function(Input : Instance?)
   if Input.UserInputType == Enum.UserInputType.MouseButton2 then
       getgenv().Settings.__AimlockToggled = false
   end
end)
